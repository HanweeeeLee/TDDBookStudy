# 32. TDD 마스터하기

## 단계가 얼마나 커야 하나?
 - 각 테스트가 다뤄야 할 범위는 얼마나 넓은가?
 - 리팩토링을 하면서 얼마나 많은 중간 단계를 거쳐야 하는가?

시간이 지남에 따라 테스트 주도 개발자의 경향은 분명히 나타난다. 단계가 점점 작아지는 것이다.  
이들 중 일부는 애플리케이션 수준의 테스트 만을 작성하기도 하고, 또 다른 일부는 우리가 지금껏 작성해온 프로그래머 수준의 테스트와 병행하기도 한다.  
리팩토링 초기에는 아주 작은 단계로 작업할 준비가 되어 있어야 한다.  
매우 작은 단계로 수작업 리팩토링을 20번 하고 나면, 몇단계 건너 뛰는 실험을 해보자.  
자동화된 리팩토링 툴은 리팩토링을 엄청나게 가속화시킨다.  
20번의 단계를 통해 해야 할 일이 메뉴 아이템 하나로 간단히 해결된다.  
훌륭한 툴의 지원이 있다는 걸 알고 있다면 코드가 어떤 구조를 갖추길 원하는지 보기 위해 여러 가지 실험을 시도하면서 리팩토링에 훨씬 적극적이게 될 것이다.

## 테스트할 필요가 없는 것은 무엇인가?
“두려움이 지루함으로 변할 때까지 테스트를 만들어라.”  
하지만 이것은 피드백 루프이고 스스로 대답을 찾아야만 한다.  
우리는 다음 것들을 테스트해야 한다.
 - 조건문
 - 반복문
 - 연산자
 - 다형성

하지만 우리가 작성하는 것들에 대해서만 테스트해라.  
불신할 이유가 없다면 다른 사람이 만든 코드를 테스트하지 마라.

## 좋은 테스트를 갖췄는지의 여부를 어떻게 알 수 있는가?
다음은 설계 문제가 있음을 알려주는 테스트의 속성이다.
 - 긴 셋업 코드
 - 셋업 중복
 - 실행 시간이 오래 걸리는 테스트 : 작은 부분만 테스트할 수 없다는 것은 설계 문제를 의미하고 설계를 적절히 변경해줄 필요가 있다.
 - 깨지기 쉬운 테스트 : 예상치 못하게 실패하는 테스트가 있다면 이는 특정 부분이 다른 부분에 이상한 방법으로 영향을 끼친다는 뜻이다.

## TDD로 프레임워크를 만들려면 어떻게 해야 하나?
 - 첫 번째 기능을 구현한다. 이 첫번째 기능은 단순하고 직관적으로 구현되고, 따라서 짧은 시간 안에 결함도 적은 상태로 완성된다.
 - 첫 번째 기능에 대한 변주가 되는 두 번째 기능을 구현한다. 두 기능 사이의 중복이 한 곳으로 모이고, 서로 다른 부분은 다른곳(다른 메서드나 심지어는 다른 클래스)으로 옮겨진다.
 - 앞의 두 기능에 대한 변주로 세 번째 기능을 구현한다. 공통의 로직은 약간의 수정만을 통해 재활용 가능한 상태로 만들어질 수 있을 것이다. 그리고 곹오적이지 않은 로직들은 다른 메서드 혹은 클래스 등 명확하게 로직이 있어야 할 곳에 있게 되는 경향이 있다.

TDD는 비록 발생하지 않은 변주 종류는 잘 표현하지 못할지라도, 발생하는 변주 종류들, 바로 그것들을 잘 표현하는 프레임워크를 만들게 해 준다.

## 피드백이 얼마나 필요한가?
테스트를 얼마나 작성할지 고려할 때, 실패간 평균시간(MTBF, Mean Time Between Failures)을 생각한다.  
어떤 테스트를 작성할 필요가 있을지 없을지는 MTBF를 얼마나 조심스럽게 측정하는지에 달렸다.  
TDD의 테스트에 대한 관점은 실용적이다. TDD에서 테스트는 어떤 목적을 위한 하나의 수단이다.  
만약 어떤 구현에 대한 지식이 신뢰할 만 하다면 그에 대한 테스트는 작성하지 않을 것이다.

## 테스트를 지워야 할 때는 언제인가?
 - 첫째 기준은 자신감이다. 테스트를 삭제할 경우 자신감이 줄어들 것 같으면 절대 테스트를 지우지 말아야 한다.
 - 둘째 기준은 커뮤니케이션이다. 두 개의 테스트가 코드의 동일한 부분을 실행하더라도, 이 둘이 서로 다른 시나리오를 말한다면 그대로 남겨두어야 한다.

자신감이나 커뮤니케이션 면에서 별 부가적인 이득이 없는 중복된 테스트가 2개 있다면 덜 유용한 것을 삭제하라.


## 프로그래밍 언어나 환경이 TDD에 어떤 영향을 주는가?
TDD주기를 수행하기 힘든 언어나 환경에서 작업하게 되면 단계가 커지는 경향이 있다.
 - 각 테스트가 더 많은 부분을 포함하게 만든다.
 - 중간 단계를 덜 거치고 리팩토링을 한다.

TDD주기를 잘 지원하는 언어와 환경에서 작업하게 되면 더 많은 실험을 해보려고 할것이다.  
이것이 더 빨리 진행하도록, 혹은 더 나은 해법에 도달하도록 도와주는가 아니면 리뷰나 문학적 프로그램을 위해 일정 시간을 제도화 하는것이 더 나을까?

## 거대한 시스템을 개발할 때에도 TDD를 할 수 있는가?
시스템에 있는 기능의 양은 TDD의 효율에 영향을 미치지 않는 것 같다.  
중복을 제거함에 따라 더 작은 객체들이 만들어지게 되고, 이 작은 객체들은 애플리케이션의 크기와 무관하게 독립적으로 테스트될 수 있다.

## 애플리케이션 수준의 테스트로도 개발을 주도할 수 있는가?
 - 기술적문제 : 고정물을 만드는 것. 아직 만들지 않은 기능에 대한 테스트를 어떻게 작성하고 실행할 것인가?
 - 사회적인 문제 : 사용자에게는 기존에 없던 새로운 책임이 되는것이다. 구현하기 전이라는 기존에 존재하지 않던 단계에서 책임이 수반된다.
 - 테스트와 피드백 사이의 길이도 문제가 될 수 있다.

## 프로젝트 중반에 TDD를 도입하려면 어떻게 해야 할까?
가장 큰 문제는 테스트를 염두에 두지 않고 만든 코드는 테스트하기가 그리 쉽지 않다는 점이다.  
일부분만을 격리해서 실행하고 결과를 검사할 수 있게끔 인터페이스가 설계되어 있지 않다.  
"고치면 되잖아" 하고 말할 수도 있을 것이다. 맞다.  
하지만 리팩토링 과정에 에러를 만들 수도 있는데, 아직 테스트가 없기 때문에 에러가 생겼다는 점을 알아낼 수 없을 것이다.  
확실히 하지 말아야 할 일이 있는데, 그것은 코드 전체를 위한 테스트를 한꺼번에 다 만들고, 코드 전체를 한번에 리팩토링하는 일이다.  
우선 해야 할 일은 변경의 범위를 제한하는 것이고, 다음으로 해야 할 일은 테스트와 리팩토링 사이에 존재하는 교착상태(deadlock)를 풀어주는 것이다.

## TDD는 누구를 위한 것인가?
TDD는 더 깔끔한 설계를 할 수 있도록, 그리고 더 많은 것을 배워감에 따라 설계를 더 개선할 수 있도록, 적절한 때 적절한 문제에 집중할 수 있게끔 도와준다.  
TDD는 현재 업게에서 통용하는 수준보다 훨씬 더 적은 수의 결함과 훨씬 더 깨끗한 설계의 코드를 작성하게 해준다.  
그렇지만 우아함에서 영혼의 안식을 찾는 이들은 선을 실행하면서 잘 사는 방법을 TDD에서 찾을 수 있다.  
TDD는 시간이 지남에 따라 코드에 대한 자신감을 점점 더 쌓아갈 수 있게 해준다.  
테스트가 쌓여감에 따라 시스템의 행위에 대한 자신감을 더 많이 얻게 된다. 설계를 개선해 나감에 따라 점점 더 많은 설계 변경이 가능해진다.

## TDD는 초기 조건에 민감한가?
테스트를 취할 때 특정한 순서로 하면 매우 매끄럽게 잘 넘어가는 것 같다.  
하지만 이게 사실일까? 단지 내 구현 기술이 부족해서 그런것은 아닐까?

## TDD와 패턴의 관계는?
반복적 행동을 규칙으로 환원함으로서 규칙을 적용하는 것은 기계적이며 단순 암기가 되고,  
이것은 언제나 최초 원리에서 시작해서 모든 것을 다시 생각하고 결정하는 것보다 더 빠르다.  
예외 혹은 규칙의 어느것도 들어맞지 않는 문제가 있을경우, 새로운것을 창조하고 적용할 더 많은 시간과 에너지를 갖게된다.  
TDD와 패턴의 또 다른 관계는 패턴 주도 설계에 대한 구현방법으로서의 TDD이다.  
완벽하게 사리에 맞는 설계가 결국은 틀린것으로 판명나기도 한다.  
그냥 시스템이 무슨일을 할지 생각하고 나중에 설계가 알아서 정해지도록 하는것이 더 낫다.

## 어째서 TDD가 잘 작동하는가?
결함을 빨리 발견해 고칠수록 비용은 낮아진다.  
전반적으로 TDD는 결과적으로 결함을 감소시켜 주고, 그에 의한 이차적인 심리적, 사회적 효과가 무척 많다.  
또 다른 효과로는 설계 결정에 대한 피드백 고리를 단축시킨다.


## 이름을 테스트 주도 개발이라고 한 이유는?
 - 개발 : 개발이란 분석,논리적 설계, 물리적 설계, 구현, 테스팅, 검토, 통합, 배포를 아우르는 복잡한 춤을 말한다.
 - 주도 : 테스트 우선 프로그래밍(test-first programming). 대부분은 프로그래밍 후 테스트를 진행하므로 그와 반대되는 개념이다.
 - 테스트 : 자동화되고 구체적이며 명확한 테스트를 말한다. TDD는 분석 기술이며, 설계 기술이기도 하다. 사실은 개발의 모든 활동을 구조화하는 기술이다.

## TDD와 익스트림 프로그래밍의 실천법 사이에 어떤 관련이 있는가?
 - 짝프로그래밍 : TDD를 하면서 작성하게 되는 테스트는 짝 프로그래밍 과정에서 뛰어난 의사소통 수단이 된다.
 - 활기차게 일하기 : 다음 테스트를 통과 시키지 못하겠거나, 어떤 테스트 두개를 동시에 통과하도록 만들 방법을 모르겠다면, 잠시 쉴 시간이다.
 - 지속적입 통합 : 테스트는 좀더 자주 통합할 수 있게 해주기 때문에 아주 훌륭한 자원이 된다.
 - 단순 설계 : 테스트를 통과하기 위해 필요한 만큼만 코딩하고 모든 중복을 제거한다면 자동으로 현재까지의 요구사항에 딱 맞는 설계를 얻게 될 것이다.
 - 리팩토링 : '중복 제거 규칙'은 리팩토링의 또 다른 이름이다. 테스트가 있다면 더 큰 리팩토링을 수행하더라도 시스템의 행위가 변하지 않았다는 자신감을 얻을 수 있다.
 - 지속적인 전달 : TDD테스트들이 시스템의 MTBF를 개선한다면, 고객을 혼란시키지 않으면서도 훨씬 더 자주 코드를 출시할 수 있을 것이다.






